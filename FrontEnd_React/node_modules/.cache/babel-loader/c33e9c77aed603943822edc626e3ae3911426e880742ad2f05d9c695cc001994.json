{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ing\\\\Desktop\\\\Stage_Pupitre\\\\CoVoitUniv\\\\Web\\\\src\\\\pages\\\\ConducteurMap.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useContext } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet-routing-machine\";\nimport { Link } from \"react-router-dom\";\nimport { AuthContext } from \"../context/AuthContext\";\nimport { useLocation } from \"react-router-dom\";\nimport \"./ConducteurMap.css\";\nimport \"../leaflet-routing-machine/leaflet-routing-machine.css\";\nimport \"../leaflet/leaflet.css\";\n//import markerIcon from 'leaflet/dist/images/marker-icon.png';\n//import markerIconRetina from 'leaflet/dist/images/marker-icon-2x.png';\nimport markerStartIconRetina from \"../leaflet/images/marker-icon-2x-green.png\";\nimport markerEndIconRetina from \"../leaflet/images/marker-icon-2x-pink.png\";\nimport markerShadow from \"leaflet/dist/images/marker-shadow.png\";\nimport startIcon from \"../leaflet/images/marker-icon-green.png\";\nimport endIcon from \"../leaflet/images/marker-icon-pink.png\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst InterfaceConducteur = () => {\n  _s();\n  const {\n    userId\n  } = useContext(AuthContext);\n  const [passagers, setPassagers] = useState([]);\n  const [map, setMap] = useState(null);\n  const location = useLocation();\n  const [markers, setMarkers] = useState({});\n  const [conducteurMarker, setConducteurMarker] = useState(null);\n  const [destinationMarker, setDestinationMarker] = useState(null);\n  const [layerGroup, setLayerGroup] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [emailSent, setEmailSent] = useState(false);\n  const startMarkerIcon = L.icon({\n    iconUrl: startIcon,\n    iconSize: [25, 41],\n    iconAnchor: [12, 41],\n    popupAnchor: [0, -41],\n    shadowUrl: markerShadow,\n    shadowSize: [41, 41],\n    shadowAnchor: [12, 41],\n    iconRetinaUrl: markerStartIconRetina\n  });\n  const endMarkerIcon = L.icon({\n    iconUrl: endIcon,\n    iconSize: [25, 41],\n    iconAnchor: [12, 41],\n    popupAnchor: [0, -41],\n    shadowUrl: markerShadow,\n    shadowSize: [41, 41],\n    shadowAnchor: [12, 41],\n    iconRetinaUrl: markerEndIconRetina\n  });\n  const createLetterIcon = letter => {\n    return L.divIcon({\n      className: \"custom-letter-icon\",\n      html: `<div class=\"letter-marker\">${letter}</div>`,\n      iconSize: [30, 42],\n      iconAnchor: [15, 42],\n      popupAnchor: [0, -35]\n    });\n  };\n  const {\n    passCond,\n    date,\n    mornEve\n  } = location.state || {}; // RÃ©cupÃ©rer les donnÃ©es passÃ©es\n  //fix bug des icones\n  /*delete L.Icon.Default.prototype._getIconUrl;\r\n    L.Icon.Default.mergeOptions({\r\n        iconRetinaUrl: markerIconRetina,\r\n        iconUrl: markerIcon,\r\n        shadowUrl: markerShadow\r\n    });*/\n\n  const [userData, setUserData] = useState(null);\n  useEffect(() => {\n    const newMap = L.map(\"map\").setView([48.8566, 2.3522], 10);\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(newMap);\n    setMap(newMap);\n\n    // RÃ©cupÃ©ration des donnÃ©es utilisateur\n    if (userId) {\n      fetch(`http://localhost:5005/user/${userId}`).then(response => response.json()).then(data => {\n        setUserData(data);\n      }).catch(error => console.error(\"Erreur lors de la rÃ©cupÃ©ration des donnÃ©es utilisateur:\", error));\n    }\n    const newLayerGroup = L.layerGroup().addTo(newMap);\n    setLayerGroup(newLayerGroup);\n    setMap(newMap);\n    return () => newMap.remove();\n  }, [userId]);\n  useEffect(() => {\n    if (map && conducteurMarker && destinationMarker) {\n      afficherTrajet(map);\n    }\n  }, [map, conducteurMarker, destinationMarker, markers]);\n  useEffect(() => {\n    Object.values(markers).forEach(marker => {\n      if (!marker._map) {\n        map.removeLayer(marker);\n      }\n    });\n  }, [markers]);\n  const afficherTrajet = (map, routesData) => {\n    var _document$querySelect;\n    if (!map) {\n      console.error(\"Carte non disponible.\");\n      return;\n    }\n    const waypoints = [];\n\n    // Ajouter le point de dÃ©part du conducteur\n    if (conducteurMarker) {\n      waypoints.push(conducteurMarker.getLatLng());\n    }\n\n    // Ajouter les passagers cochÃ©s comme waypoints intermÃ©diaires\n    const passagersCoches = Object.values(markers).map(marker => marker.getLatLng());\n    waypoints.push(...passagersCoches);\n\n    // Ajouter la destination finale\n    if (destinationMarker) {\n      waypoints.push(destinationMarker.getLatLng());\n    }\n\n    // VÃ©rifier s'il y a au moins un trajet conducteur â†’ destination\n    if (waypoints.length < 2) {\n      console.error(\"Impossible d'afficher un itinÃ©raire.\");\n      return;\n    }\n\n    // Supprimer l'ancien itinÃ©raire s'il existe\n    if (map.routeLayer) {\n      map.removeControl(map.routeLayer);\n      map.routeLayer = null;\n    }\n\n    // Ajouter l'itinÃ©raire sur la carte\n    map.routeLayer = L.Routing.control({\n      waypoints,\n      lineOptions: {\n        styles: [{\n          color: \"blue\",\n          weight: 5\n        }]\n      },\n      createMarker: function (i, waypoint, n) {\n        if (i === 0) return L.marker(waypoint.latLng, {\n          icon: startMarkerIcon\n        }).bindPopup(\"DÃ©part Conducteur\");\n        if (i === n - 1) return L.marker(waypoint.latLng, {\n          icon: endMarkerIcon\n        }).bindPopup(\"Destination Finale\");\n\n        // Convertir l'index en lettre (A, B, C, ...)\n        const letter = String.fromCharCode(65 + i - 1); // i-1 car 0 = dÃ©part\n        const letterIcon = createLetterIcon(letter);\n        return L.marker(waypoint.latLng, {\n          icon: letterIcon\n        }).bindPopup(`Passager ${letter}`);\n      },\n      routeWhileDragging: false,\n      draggableWaypoints: false,\n      addWaypoints: false,\n      autoRoute: true\n    }).addTo(map);\n    (_document$querySelect = document.querySelector(\".leaflet-routing-container\")) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.remove();\n  };\n  const fetchPassagers = async () => {\n    if (!userId || !map) return;\n    setIsLoading(true); // DÃ©but\n\n    try {\n      var _firstPassenger$route;\n      const response = await fetch(`http://localhost:5005/find_passengers`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          user_id: userId,\n          timeSlot: mornEve,\n          day: date\n        })\n      });\n      const data = await response.json();\n      console.log(\"Passagers rÃ©cupÃ©rÃ©s :\", data);\n      if (!data.possible_passengers || data.possible_passengers.length === 0) {\n        console.log(\"Aucun passager trouvÃ©.\");\n        return;\n      }\n      setPassagers(data.possible_passengers);\n      const firstPassenger = data.possible_passengers[0];\n      if (!(firstPassenger !== null && firstPassenger !== void 0 && (_firstPassenger$route = firstPassenger.routes) !== null && _firstPassenger$route !== void 0 && _firstPassenger$route.driver_to_passenger)) {\n        console.error(\"firstPassenger ou ses routes sont invalides.\");\n        return;\n      }\n      const driverCoords = firstPassenger.routes.driver_to_passenger.geometry[0];\n      const destinationCoords = firstPassenger.routes.passenger_to_destination.geometry[1];\n      if (driverCoords && !conducteurMarker) {\n        const driverMarker = L.marker([driverCoords[0], driverCoords[1]], {\n          icon: startMarkerIcon\n        }).addTo(map).bindPopup(\"Conducteur\");\n        setConducteurMarker(driverMarker);\n      }\n      if (destinationCoords && !destinationMarker) {\n        const destMarker = L.marker([destinationCoords[0], destinationCoords[1]], {\n          icon: endMarkerIcon\n        }).addTo(map).bindPopup(\"Destination Finale\");\n        setDestinationMarker(destMarker);\n      }\n    } catch (error) {\n      console.error(\"Erreur lors de la rÃ©cupÃ©ration des passagers:\", error);\n    } finally {\n      setIsLoading(false); // âœ… FIN NORMALE OU AVEC ERREUR\n    }\n  };\n  const toggleMarker = passager => {\n    if (!layerGroup || !map) return;\n    const passengerId = passager.passenger_id;\n    const passengerCoords = passager.routes.driver_to_passenger.geometry[1];\n    setMarkers(prevMarkers => {\n      const newMarkers = {\n        ...prevMarkers\n      };\n      if (newMarkers[passengerId]) {\n        console.log(`ðŸ—‘ Suppression du marqueur du passager ${passengerId}`);\n        layerGroup.removeLayer(newMarkers[passengerId]); // Suppression du marqueur\n        delete newMarkers[passengerId];\n      } else {\n        console.log(`âž• Ajout du marqueur du passager ${passengerId}`);\n        const letter = String.fromCharCode(65 + Object.keys(prevMarkers).length); // ou une autre logique\n        const marker = L.marker([passengerCoords[0], passengerCoords[1]], {\n          icon: createLetterIcon(letter)\n        }).bindPopup(`${passager.first_name} ${passager.last_name} - ${passager.address}`);\n        layerGroup.addLayer(marker); // Ajout dans le LayerGroup\n        newMarkers[passengerId] = marker;\n        // Ajuster la vue pour englober tous les marqueurs et le trajet\n        const allMarkers = Object.values(newMarkers).map(marker => marker.getLatLng());\n\n        // Ajouter le conducteur et la destination s'ils existent\n        if (conducteurMarker) allMarkers.push(conducteurMarker.getLatLng());\n        if (destinationMarker) allMarkers.push(destinationMarker.getLatLng());\n        if (allMarkers.length > 1) {\n          const bounds = L.latLngBounds(allMarkers);\n          map.fitBounds(bounds, {\n            padding: [50, 50]\n          }); // Ajuster le zoom\n        }\n      }\n      return newMarkers; // Met Ã  jour l'Ã©tat des marqueurs\n    });\n  };\n  const handleSendOffers = async () => {\n    if (!userId) {\n      console.error(\"Utilisateur non identifiÃ©.\");\n      return;\n    }\n    const selectedPassengers = Object.keys(markers);\n    if (selectedPassengers.length === 0) {\n      alert(\"Aucun passager sÃ©lectionnÃ© !\");\n      return;\n    }\n    try {\n      for (const passengerId of selectedPassengers) {\n        const passenger = passagers.find(p => p.passenger_id === passengerId);\n        if (!passenger) continue;\n        const response = await fetch(\"http://localhost:5005/offerPassenger\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            driver_id: userId,\n            ride_request_id: passenger.ride_request_id\n          })\n        });\n        const data = await response.json();\n        if (!response.ok) {\n          console.error(`Erreur pour le passager ${passengerId}:`, data.error);\n        } else {\n          console.log(`Offre envoyÃ©e au passager ${passengerId}.`);\n        }\n      }\n      alert(\"Les utliisateurs sÃ©lectionnÃ©s ont Ã©tÃ© contactÃ©s.\");\n    } catch (error) {\n      console.error(\"Erreur lors de l'envoi des offres :\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  useEffect(() => {\n    if (map && userId && layerGroup) {\n      fetchPassagers();\n    }\n  }, [map, userId, layerGroup]);\n  const formatDuration = minutes => {\n    if (!minutes) return \"\";\n    /*arrondir minutes*/\n    minutes = Math.round(minutes);\n    return `+${minutes} min`;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"conducteur-map-container\",\n    style: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n      width: \"100%\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        textAlign: \"center\",\n        marginBottom: \"20px\"\n      },\n      children: [\"Trajet du\", \" \", new Date(date).toLocaleDateString(\"fr-FR\", {\n        weekday: \"long\",\n        day: \"numeric\",\n        month: \"long\",\n        year: \"numeric\"\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        width: \"100%\",\n        gap: \"20px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\",\n        style: {\n          width: \"70%\",\n          height: \"750px\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"options-passagers\",\n        style: {\n          width: \"30%\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"center\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Passagers Disponibles\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 11\n        }, this), date && /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            marginBottom: \"10px\",\n            padding: \"10px\",\n            borderRadius: \"5px\",\n            fontWeight: \"bold\",\n            color: \"white\",\n            backgroundColor: \"#927e6e\"\n          },\n          children: [\"Pour le\", \" \", new Date(date).toLocaleDateString(\"fr-FR\", {\n            weekday: \"long\",\n            day: \"numeric\",\n            month: \"long\",\n            year: \"numeric\"\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: fetchPassagers,\n          children: \"Charger les passagers\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"passagers-list\",\n          style: {\n            marginTop: \"10px\",\n            width: \"100%\",\n            textAlign: \"center\",\n            color: \"white\"\n          },\n          children: isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"loader\",\n            children: \" \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 15\n          }, this) : passagers.length > 0 ? passagers.map(passager => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"space-between\",\n              width: \"80%\",\n              color: \"white\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                flexDirection: \"column\",\n                alignItems: \"flex-start\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                style: {\n                  margin: 0\n                },\n                children: [passager.first_name, \" \", passager.last_name]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 436,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  fontSize: \"0.9em\",\n                  color: \"#f5deb3\"\n                },\n                children: formatDuration(passager.passengers_duration - passager.normal_duration)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 439,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 429,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              onChange: () => toggleMarker(passager)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 19\n            }, this)]\n          }, passager.passenger_id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 17\n          }, this)) : /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Aucun passager trouv\\xE9.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSendOffers,\n      style: {\n        marginTop: \"20px\",\n        padding: \"10px\",\n        backgroundColor: \"blue\",\n        color: \"white\",\n        border: \"none\",\n        cursor: \"pointer\"\n      },\n      children: \"Envoyer les offres aux passagers s\\xE9lectionn\\xE9s\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 457,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 341,\n    columnNumber: 5\n  }, this);\n};\n_s(InterfaceConducteur, \"UFOFhN5e8eAt9Y97/U4SV3OG1WQ=\", false, function () {\n  return [useLocation];\n});\n_c = InterfaceConducteur;\nfunction ConducteurMap() {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(InterfaceConducteur, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 477,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 476,\n    columnNumber: 5\n  }, this);\n}\n_c2 = ConducteurMap;\nexport default ConducteurMap;\nvar _c, _c2;\n$RefreshReg$(_c, \"InterfaceConducteur\");\n$RefreshReg$(_c2, \"ConducteurMap\");","map":{"version":3,"names":["React","useEffect","useState","useContext","L","Link","AuthContext","useLocation","markerStartIconRetina","markerEndIconRetina","markerShadow","startIcon","endIcon","jsxDEV","_jsxDEV","InterfaceConducteur","_s","userId","passagers","setPassagers","map","setMap","location","markers","setMarkers","conducteurMarker","setConducteurMarker","destinationMarker","setDestinationMarker","layerGroup","setLayerGroup","isLoading","setIsLoading","emailSent","setEmailSent","startMarkerIcon","icon","iconUrl","iconSize","iconAnchor","popupAnchor","shadowUrl","shadowSize","shadowAnchor","iconRetinaUrl","endMarkerIcon","createLetterIcon","letter","divIcon","className","html","passCond","date","mornEve","state","userData","setUserData","newMap","setView","tileLayer","attribution","addTo","fetch","then","response","json","data","catch","error","console","newLayerGroup","remove","afficherTrajet","Object","values","forEach","marker","_map","removeLayer","routesData","_document$querySelect","waypoints","push","getLatLng","passagersCoches","length","routeLayer","removeControl","Routing","control","lineOptions","styles","color","weight","createMarker","i","waypoint","n","latLng","bindPopup","String","fromCharCode","letterIcon","routeWhileDragging","draggableWaypoints","addWaypoints","autoRoute","document","querySelector","fetchPassagers","_firstPassenger$route","method","headers","body","JSON","stringify","user_id","timeSlot","day","log","possible_passengers","firstPassenger","routes","driver_to_passenger","driverCoords","geometry","destinationCoords","passenger_to_destination","driverMarker","destMarker","toggleMarker","passager","passengerId","passenger_id","passengerCoords","prevMarkers","newMarkers","keys","first_name","last_name","address","addLayer","allMarkers","bounds","latLngBounds","fitBounds","padding","handleSendOffers","selectedPassengers","alert","passenger","find","p","driver_id","ride_request_id","ok","formatDuration","minutes","Math","round","style","display","flexDirection","alignItems","width","children","textAlign","marginBottom","Date","toLocaleDateString","weekday","month","year","fileName","_jsxFileName","lineNumber","columnNumber","justifyContent","gap","id","height","borderRadius","fontWeight","backgroundColor","onClick","marginTop","margin","fontSize","passengers_duration","normal_duration","type","onChange","border","cursor","_c","ConducteurMap","_c2","$RefreshReg$"],"sources":["C:/Users/ing/Desktop/Stage_Pupitre/CoVoitUniv/Web/src/pages/ConducteurMap.jsx"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet-routing-machine\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { AuthContext } from \"../context/AuthContext\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport \"./ConducteurMap.css\";\r\nimport \"../leaflet-routing-machine/leaflet-routing-machine.css\";\r\nimport \"../leaflet/leaflet.css\";\r\n//import markerIcon from 'leaflet/dist/images/marker-icon.png';\r\n//import markerIconRetina from 'leaflet/dist/images/marker-icon-2x.png';\r\nimport markerStartIconRetina from \"../leaflet/images/marker-icon-2x-green.png\";\r\nimport markerEndIconRetina from \"../leaflet/images/marker-icon-2x-pink.png\";\r\nimport markerShadow from \"leaflet/dist/images/marker-shadow.png\";\r\nimport startIcon from \"../leaflet/images/marker-icon-green.png\";\r\nimport endIcon from \"../leaflet/images/marker-icon-pink.png\";\r\n\r\nconst InterfaceConducteur = () => {\r\n  const { userId } = useContext(AuthContext);\r\n  const [passagers, setPassagers] = useState([]);\r\n  const [map, setMap] = useState(null);\r\n  const location = useLocation();\r\n  const [markers, setMarkers] = useState({});\r\n  const [conducteurMarker, setConducteurMarker] = useState(null);\r\n  const [destinationMarker, setDestinationMarker] = useState(null);\r\n  const [layerGroup, setLayerGroup] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [emailSent, setEmailSent] = useState(false);\r\n\r\n\r\n  const startMarkerIcon = L.icon({\r\n    iconUrl: startIcon,\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41],\r\n    popupAnchor: [0, -41],\r\n    shadowUrl: markerShadow,\r\n    shadowSize: [41, 41],\r\n    shadowAnchor: [12, 41],\r\n    iconRetinaUrl: markerStartIconRetina,\r\n  });\r\n\r\n  const endMarkerIcon = L.icon({\r\n    iconUrl: endIcon,\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41],\r\n    popupAnchor: [0, -41],\r\n    shadowUrl: markerShadow,\r\n    shadowSize: [41, 41],\r\n    shadowAnchor: [12, 41],\r\n    iconRetinaUrl: markerEndIconRetina,\r\n  });\r\n\r\n  const createLetterIcon = (letter) => {\r\n    return L.divIcon({\r\n      className: \"custom-letter-icon\",\r\n      html: `<div class=\"letter-marker\">${letter}</div>`,\r\n      iconSize: [30, 42],\r\n      iconAnchor: [15, 42],\r\n      popupAnchor: [0, -35],\r\n    });\r\n  };\r\n\r\n  const { passCond, date, mornEve } = location.state || {}; // RÃ©cupÃ©rer les donnÃ©es passÃ©es\r\n  //fix bug des icones\r\n  /*delete L.Icon.Default.prototype._getIconUrl;\r\n    L.Icon.Default.mergeOptions({\r\n        iconRetinaUrl: markerIconRetina,\r\n        iconUrl: markerIcon,\r\n        shadowUrl: markerShadow\r\n    });*/\r\n\r\n  const [userData, setUserData] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const newMap = L.map(\"map\").setView([48.8566, 2.3522], 10);\r\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n      attribution:\r\n        '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    }).addTo(newMap);\r\n    setMap(newMap);\r\n\r\n    // RÃ©cupÃ©ration des donnÃ©es utilisateur\r\n    if (userId) {\r\n      fetch(`http://localhost:5005/user/${userId}`)\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n          setUserData(data);\r\n        })\r\n        .catch((error) =>\r\n          console.error(\r\n            \"Erreur lors de la rÃ©cupÃ©ration des donnÃ©es utilisateur:\",\r\n            error\r\n          )\r\n        );\r\n    }\r\n    const newLayerGroup = L.layerGroup().addTo(newMap);\r\n    setLayerGroup(newLayerGroup);\r\n    setMap(newMap);\r\n\r\n    return () => newMap.remove();\r\n  }, [userId]);\r\n  useEffect(() => {\r\n    if (map && conducteurMarker && destinationMarker) {\r\n      afficherTrajet(map);\r\n    }\r\n  }, [map, conducteurMarker, destinationMarker, markers]);\r\n\r\n  useEffect(() => {\r\n    Object.values(markers).forEach((marker) => {\r\n      if (!marker._map) {\r\n        map.removeLayer(marker);\r\n      }\r\n    });\r\n  }, [markers]);\r\n\r\n  const afficherTrajet = (map, routesData) => {\r\n    if (!map) {\r\n      console.error(\"Carte non disponible.\");\r\n      return;\r\n    }\r\n\r\n    const waypoints = [];\r\n\r\n    // Ajouter le point de dÃ©part du conducteur\r\n    if (conducteurMarker) {\r\n      waypoints.push(conducteurMarker.getLatLng());\r\n    }\r\n\r\n    // Ajouter les passagers cochÃ©s comme waypoints intermÃ©diaires\r\n    const passagersCoches = Object.values(markers).map((marker) =>\r\n      marker.getLatLng()\r\n    );\r\n    waypoints.push(...passagersCoches);\r\n\r\n    // Ajouter la destination finale\r\n    if (destinationMarker) {\r\n      waypoints.push(destinationMarker.getLatLng());\r\n    }\r\n\r\n    // VÃ©rifier s'il y a au moins un trajet conducteur â†’ destination\r\n    if (waypoints.length < 2) {\r\n      console.error(\"Impossible d'afficher un itinÃ©raire.\");\r\n      return;\r\n    }\r\n\r\n    // Supprimer l'ancien itinÃ©raire s'il existe\r\n    if (map.routeLayer) {\r\n      map.removeControl(map.routeLayer);\r\n      map.routeLayer = null;\r\n    }\r\n\r\n    // Ajouter l'itinÃ©raire sur la carte\r\n    map.routeLayer = L.Routing.control({\r\n      waypoints,\r\n      lineOptions: { styles: [{ color: \"blue\", weight: 5 }] },\r\n      createMarker: function (i, waypoint, n) {\r\n        if (i === 0)\r\n          return L.marker(waypoint.latLng, { icon: startMarkerIcon }).bindPopup(\r\n            \"DÃ©part Conducteur\"\r\n          );\r\n        if (i === n - 1)\r\n          return L.marker(waypoint.latLng, { icon: endMarkerIcon }).bindPopup(\r\n            \"Destination Finale\"\r\n          );\r\n\r\n        // Convertir l'index en lettre (A, B, C, ...)\r\n        const letter = String.fromCharCode(65 + i - 1); // i-1 car 0 = dÃ©part\r\n        const letterIcon = createLetterIcon(letter);\r\n        return L.marker(waypoint.latLng, { icon: letterIcon }).bindPopup(\r\n          `Passager ${letter}`\r\n        );\r\n      },\r\n      routeWhileDragging: false,\r\n      draggableWaypoints: false,\r\n      addWaypoints: false,\r\n      autoRoute: true,\r\n    }).addTo(map);\r\n    document.querySelector(\".leaflet-routing-container\")?.remove();\r\n  };\r\n\r\n  const fetchPassagers = async () => {\r\n    if (!userId || !map) return;\r\n\r\n    setIsLoading(true); // DÃ©but\r\n\r\n    try {\r\n      const response = await fetch(`http://localhost:5005/find_passengers`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ user_id: userId, timeSlot: mornEve, day: date }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      console.log(\"Passagers rÃ©cupÃ©rÃ©s :\", data);\r\n\r\n      if (!data.possible_passengers || data.possible_passengers.length === 0) {\r\n        console.log(\"Aucun passager trouvÃ©.\");\r\n        return;\r\n      }\r\n\r\n      setPassagers(data.possible_passengers);\r\n\r\n      const firstPassenger = data.possible_passengers[0];\r\n      if (!firstPassenger?.routes?.driver_to_passenger) {\r\n        console.error(\"firstPassenger ou ses routes sont invalides.\");\r\n        return;\r\n      }\r\n\r\n      const driverCoords =\r\n        firstPassenger.routes.driver_to_passenger.geometry[0];\r\n      const destinationCoords =\r\n        firstPassenger.routes.passenger_to_destination.geometry[1];\r\n\r\n      if (driverCoords && !conducteurMarker) {\r\n        const driverMarker = L.marker([driverCoords[0], driverCoords[1]], {\r\n          icon: startMarkerIcon,\r\n        })\r\n          .addTo(map)\r\n          .bindPopup(\"Conducteur\");\r\n        setConducteurMarker(driverMarker);\r\n      }\r\n\r\n      if (destinationCoords && !destinationMarker) {\r\n        const destMarker = L.marker(\r\n          [destinationCoords[0], destinationCoords[1]],\r\n          {\r\n            icon: endMarkerIcon,\r\n          }\r\n        )\r\n          .addTo(map)\r\n          .bindPopup(\"Destination Finale\");\r\n        setDestinationMarker(destMarker);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Erreur lors de la rÃ©cupÃ©ration des passagers:\", error);\r\n    } finally {\r\n      setIsLoading(false); // âœ… FIN NORMALE OU AVEC ERREUR\r\n    }\r\n  };\r\n\r\n  const toggleMarker = (passager) => {\r\n    if (!layerGroup || !map) return;\r\n\r\n    const passengerId = passager.passenger_id;\r\n    const passengerCoords = passager.routes.driver_to_passenger.geometry[1];\r\n\r\n    setMarkers((prevMarkers) => {\r\n      const newMarkers = { ...prevMarkers };\r\n\r\n      if (newMarkers[passengerId]) {\r\n        console.log(`ðŸ—‘ Suppression du marqueur du passager ${passengerId}`);\r\n        layerGroup.removeLayer(newMarkers[passengerId]); // Suppression du marqueur\r\n        delete newMarkers[passengerId];\r\n      } else {\r\n        console.log(`âž• Ajout du marqueur du passager ${passengerId}`);\r\n\r\n        const letter = String.fromCharCode(\r\n          65 + Object.keys(prevMarkers).length\r\n        ); // ou une autre logique\r\n        const marker = L.marker([passengerCoords[0], passengerCoords[1]], {\r\n          icon: createLetterIcon(letter),\r\n        }).bindPopup(\r\n          `${passager.first_name} ${passager.last_name} - ${passager.address}`\r\n        );\r\n\r\n        layerGroup.addLayer(marker); // Ajout dans le LayerGroup\r\n        newMarkers[passengerId] = marker;\r\n        // Ajuster la vue pour englober tous les marqueurs et le trajet\r\n        const allMarkers = Object.values(newMarkers).map((marker) =>\r\n          marker.getLatLng()\r\n        );\r\n\r\n        // Ajouter le conducteur et la destination s'ils existent\r\n        if (conducteurMarker) allMarkers.push(conducteurMarker.getLatLng());\r\n        if (destinationMarker) allMarkers.push(destinationMarker.getLatLng());\r\n\r\n        if (allMarkers.length > 1) {\r\n          const bounds = L.latLngBounds(allMarkers);\r\n          map.fitBounds(bounds, { padding: [50, 50] }); // Ajuster le zoom\r\n        }\r\n      }\r\n\r\n      return newMarkers; // Met Ã  jour l'Ã©tat des marqueurs\r\n    });\r\n  };\r\n\r\n  const handleSendOffers = async () => {\r\n    if (!userId) {\r\n      console.error(\"Utilisateur non identifiÃ©.\");\r\n      return;\r\n    }\r\n\r\n    const selectedPassengers = Object.keys(markers);\r\n    if (selectedPassengers.length === 0) {\r\n      alert(\"Aucun passager sÃ©lectionnÃ© !\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      for (const passengerId of selectedPassengers) {\r\n        const passenger = passagers.find((p) => p.passenger_id === passengerId);\r\n        if (!passenger) continue;\r\n\r\n        const response = await fetch(\"http://localhost:5005/offerPassenger\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({\r\n            driver_id: userId,\r\n            ride_request_id: passenger.ride_request_id,\r\n          }),\r\n        });\r\n\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n          console.error(`Erreur pour le passager ${passengerId}:`, data.error);\r\n        } else {\r\n          console.log(`Offre envoyÃ©e au passager ${passengerId}.`);\r\n        }\r\n      }\r\n      alert(\"Les utliisateurs sÃ©lectionnÃ©s ont Ã©tÃ© contactÃ©s.\");\r\n    } catch (error) {\r\n      console.error(\"Erreur lors de l'envoi des offres :\", error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    if (map && userId && layerGroup) {\r\n      fetchPassagers();\r\n    }\r\n  }, [map, userId, layerGroup]);\r\n\r\n  const formatDuration = (minutes) => {\r\n    if (!minutes) return \"\";\r\n    /*arrondir minutes*/\r\n    minutes = Math.round(minutes);\r\n    return `+${minutes} min`;\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"conducteur-map-container\"\r\n      style={{\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        alignItems: \"center\",\r\n        width: \"100%\",\r\n      }}\r\n    >\r\n      {/* Date centrÃ©e au-dessus */}\r\n      <h2 style={{ textAlign: \"center\", marginBottom: \"20px\" }}>\r\n        Trajet du{\" \"}\r\n        {new Date(date).toLocaleDateString(\"fr-FR\", {\r\n          weekday: \"long\",\r\n          day: \"numeric\",\r\n          month: \"long\",\r\n          year: \"numeric\",\r\n        })}\r\n      </h2>\r\n\r\n      {/* Conteneur avec carte Ã  gauche et passagers Ã  droite */}\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"center\",\r\n          width: \"100%\",\r\n          gap: \"20px\",\r\n        }}\r\n      >\r\n        {/* Carte Ã  gauche */}\r\n        <div id=\"map\" style={{ width: \"70%\", height: \"750px\" }}></div>\r\n\r\n        {/* Liste des passagers Ã  droite */}\r\n        <div\r\n          id=\"options-passagers\"\r\n          style={{\r\n            width: \"30%\",\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n            alignItems: \"center\",\r\n          }}\r\n        >\r\n          <h2>Passagers Disponibles</h2>\r\n          {date && (\r\n            <p\r\n              style={{\r\n                marginBottom: \"10px\",\r\n                padding: \"10px\",\r\n                borderRadius: \"5px\",\r\n                fontWeight: \"bold\",\r\n                color: \"white\",\r\n                backgroundColor: \"#927e6e\",\r\n              }}\r\n            >\r\n              Pour le{\" \"}\r\n              {new Date(date).toLocaleDateString(\"fr-FR\", {\r\n                weekday: \"long\",\r\n                day: \"numeric\",\r\n                month: \"long\",\r\n                year: \"numeric\",\r\n              })}\r\n            </p>\r\n          )}\r\n\r\n          <button onClick={fetchPassagers}>Charger les passagers</button>\r\n          <div\r\n            id=\"passagers-list\"\r\n            style={{\r\n              marginTop: \"10px\",\r\n              width: \"100%\",\r\n              textAlign: \"center\",\r\n              color: \"white\",\r\n            }}\r\n          >\r\n            {isLoading ? (\r\n              <div className=\"loader\"> </div>\r\n            ) : passagers.length > 0 ? (\r\n              passagers.map((passager) => (\r\n                <div\r\n                  key={passager.passenger_id}\r\n                  style={{\r\n                    display: \"flex\",\r\n                    alignItems: \"center\",\r\n                    justifyContent: \"space-between\",\r\n                    width: \"80%\",\r\n                    color: \"white\",\r\n                  }}\r\n                >\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      flexDirection: \"column\",\r\n                      alignItems: \"flex-start\",\r\n                    }}\r\n                  >\r\n                    <p style={{ margin: 0 }}>\r\n                      {passager.first_name} {passager.last_name}\r\n                    </p>\r\n                    <span style={{ fontSize: \"0.9em\", color: \"#f5deb3\" }}>\r\n                      {formatDuration(\r\n                        (passager.passengers_duration - passager.normal_duration)\r\n                      )}\r\n                    </span>\r\n                  </div>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    onChange={() => toggleMarker(passager)}\r\n                  />\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <p>Aucun passager trouvÃ©.</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <button\r\n        onClick={handleSendOffers}\r\n        style={{\r\n          marginTop: \"20px\",\r\n          padding: \"10px\",\r\n          backgroundColor: \"blue\",\r\n          color: \"white\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n      >\r\n        Envoyer les offres aux passagers sÃ©lectionnÃ©s\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction ConducteurMap() {\r\n  return (\r\n    <div>\r\n      <InterfaceConducteur />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ConducteurMap;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}